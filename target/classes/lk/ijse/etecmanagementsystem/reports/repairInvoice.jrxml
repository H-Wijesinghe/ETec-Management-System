<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="RepairInvoice" language="java" pageWidth="420" pageHeight="595" columnWidth="380" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="6ed00e72-d61c-4e97-8470-e34a1cc40b86">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="MYSQL"/>
	<parameter name="repairId" class="java.lang.Integer"/>
	<query language="SQL"><![CDATA[SELECT
			rj.repair_id,
			s.sale_id,
			DATE_FORMAT(s.sale_date, '%Y-%m-%d %h:%i %p') as invoice_date,
			c.name AS cus_name,
			c.number AS cus_contact,
			c.address AS cus_address,
			rj.device_name,
			rj.device_sn,
			rj.labor_cost,
			s.grand_total,
			(SELECT IFNULL(SUM(amount), 0) FROM TransactionRecord tr WHERE tr.sale_id = s.sale_id) as amount_paid,
			p.name AS part_name,
			p.sell_price AS part_price
		FROM RepairJob rj
		JOIN RepairSale rs ON rj.repair_id = rs.repair_id
		JOIN Sales s ON rs.sale_id = s.sale_id
		JOIN Customer c ON rj.cus_id = c.cus_id
		LEFT JOIN RepairItem ri ON rj.repair_id = ri.repair_id
		LEFT JOIN ProductItem pi ON ri.item_id = pi.item_id
		LEFT JOIN Product p ON pi.stock_id = p.stock_id
		WHERE rj.repair_id = $P{repairId}]]></query>
	<field name="repair_id" class="java.lang.Integer"/>
	<field name="sale_id" class="java.lang.Integer"/>
	<field name="invoice_date" class="java.lang.String"/>
	<field name="cus_name" class="java.lang.String"/>
	<field name="cus_contact" class="java.lang.String"/>
	<field name="cus_address" class="java.lang.String"/>
	<field name="device_name" class="java.lang.String"/>
	<field name="device_sn" class="java.lang.String"/>
	<field name="labor_cost" class="java.math.BigDecimal"/>
	<field name="grand_total" class="java.math.BigDecimal"/>
	<field name="amount_paid" class="java.math.BigDecimal"/>
	<field name="part_name" class="java.lang.String"/>
	<field name="part_price" class="java.math.BigDecimal"/>
	<variable name="BalanceDue" class="java.math.BigDecimal">
		<expression><![CDATA[$F{grand_total}.subtract($F{amount_paid})]]></expression>
	</variable>
	<background splitType="Stretch"/>
	<title height="90" splitType="Stretch">
		<element kind="staticText" uuid="d9202e51-75d5-4eb2-bd5e-b11878580cc9" x="0" y="0" width="380" height="30" forecolor="#2C3E50" fontSize="22.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
			<text><![CDATA[ETec Computers]]></text>
		</element>
		<element kind="staticText" uuid="19db1ab9-0473-4ff2-94de-feeb80643b80" x="0" y="30" width="380" height="20" forecolor="#7F8C8D" fontSize="10.0" hTextAlign="Center">
			<text><![CDATA[123 Tech Street, Colombo 07 | Tel: +94 77 123 4567]]></text>
		</element>
		<element kind="staticText" uuid="739341b9-eb2c-4655-ad15-3fd02217f9da" x="0" y="60" width="380" height="25" fontSize="14.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
			<text><![CDATA[SERVICE INVOICE]]></text>
		</element>
		<element kind="line" uuid="89bea216-1c0f-4101-b547-3873246615f8" x="0" y="85" width="380" height="1">
			<pen lineWidth="1.5"/>
		</element>
	</title>
	<pageHeader height="90" splitType="Stretch">
		<element kind="rectangle" uuid="23c5aeab-793a-4778-8967-4137bc6da54a" x="0" y="0" width="380" height="85" backcolor="#FAFAFA" radius="5">
			<pen lineWidth="0.5" lineColor="#DDDDDD"/>
		</element>
		<element kind="staticText" uuid="971c1a6f-188c-4273-853d-11c36341de18" x="230" y="10" width="60" height="15" forecolor="#555555" fontSize="9.0" bold="true" hTextAlign="Right">
			<text><![CDATA[Invoice #:]]></text>
		</element>
		<element kind="textField" uuid="fa24a4a9-260a-41bc-8b24-9f91f6371821" x="295" y="10" width="80" height="15" fontSize="10.0" bold="true" hTextAlign="Right">
			<expression><![CDATA[$F{sale_id}]]></expression>
		</element>
		<element kind="staticText" uuid="c3bc6ada-66fb-44a7-8c3a-13766606e79e" x="230" y="25" width="60" height="15" forecolor="#555555" fontSize="9.0" bold="true" hTextAlign="Right">
			<text><![CDATA[Date:]]></text>
		</element>
		<element kind="textField" uuid="cea04b9d-54e1-4256-b5d7-497a54ca1427" x="250" y="25" width="125" height="15" fontSize="9.0" hTextAlign="Right">
			<expression><![CDATA[$F{invoice_date}]]></expression>
		</element>
		<element kind="staticText" uuid="714a23a3-af57-4a29-bf9a-fdda59c71b6f" x="10" y="10" width="60" height="15" forecolor="#555555" fontSize="9.0" bold="true">
			<text><![CDATA[Bill To:]]></text>
		</element>
		<element kind="textField" uuid="830fe24e-ef8e-44ac-a64b-5acfc65e24cd" x="10" y="25" width="180" height="15" fontSize="10.0" bold="true">
			<expression><![CDATA[$F{cus_name}]]></expression>
		</element>
		<element kind="textField" uuid="34e8448e-fd5d-42fc-a372-0227b2dc72ae" x="10" y="40" width="180" height="15" fontSize="9.0">
			<expression><![CDATA[$F{cus_contact}]]></expression>
		</element>
		<element kind="line" uuid="e04d7de4-2dbf-4e22-83e4-f251220da284" x="10" y="60" width="360" height="1" forecolor="#EEEEEE"/>
		<element kind="staticText" uuid="334c2270-35ae-46c6-92e3-e3ae74ae9eb6" x="10" y="65" width="50" height="15" forecolor="#555555" fontSize="9.0" bold="true">
			<text><![CDATA[Device:]]></text>
		</element>
		<element kind="textField" uuid="b12f4a96-d327-4035-a6ae-4bae0f8b312f" x="60" y="65" width="200" height="15" fontSize="9.0">
			<expression><![CDATA[$F{device_name} + " (" + ($F{device_sn}!=null?$F{device_sn}:"") + ")"]]></expression>
		</element>
		<element kind="staticText" uuid="fcc3e180-2e35-4df0-bf67-241f1c655e5f" x="280" y="65" width="40" height="15" forecolor="#555555" fontSize="9.0" bold="true">
			<text><![CDATA[Job ID:]]></text>
		</element>
		<element kind="textField" uuid="43e704de-f63a-4ea4-aa70-c705b59c4549" x="320" y="65" width="50" height="15" fontSize="9.0" bold="true" hTextAlign="Right">
			<expression><![CDATA["#" + $F{repair_id}]]></expression>
		</element>
	</pageHeader>
	<columnHeader height="25" splitType="Stretch">
		<element kind="staticText" uuid="6cd9f605-69cb-45e6-84b8-087cad7f1651" x="10" y="5" width="230" height="15" fontSize="10.0" bold="true">
			<text><![CDATA[Description]]></text>
		</element>
		<element kind="staticText" uuid="5400b3ba-bf58-422f-9f34-f408c65b12da" x="280" y="5" width="90" height="15" fontSize="10.0" bold="true" hTextAlign="Right">
			<text><![CDATA[Amount]]></text>
		</element>
		<element kind="line" uuid="236f2ec6-44e8-497a-b917-ff71237b5435" x="0" y="22" width="380" height="1">
			<pen lineWidth="1.0"/>
		</element>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<printWhenExpression><![CDATA[$F{part_name} != null]]></printWhenExpression>
			<element kind="textField" uuid="ee6536f6-7cdd-4fbe-9833-a4b0224030ee" x="20" y="2" width="250" height="15" fontSize="10.0">
				<expression><![CDATA[$F{part_name}]]></expression>
			</element>
			<element kind="textField" uuid="05c5df5f-2780-485e-94dd-c7b6636ca259" x="280" y="2" width="90" height="15" fontSize="10.0" pattern="#,##0.00" hTextAlign="Right">
				<expression><![CDATA[$F{part_price}]]></expression>
			</element>
		</band>
	</detail>
	<summary height="140" splitType="Stretch">
		<element kind="staticText" uuid="819a487b-aabf-4ac9-b980-a78ff37ce534" x="20" y="5" width="220" height="15" fontSize="10.0">
			<text><![CDATA[Service Charge (Labor)]]></text>
		</element>
		<element kind="textField" uuid="5b4fb0fb-2bb2-4aaa-92c8-489afaae0505" x="280" y="5" width="90" height="15" fontSize="10.0" pattern="#,##0.00" hTextAlign="Right">
			<expression><![CDATA[$F{labor_cost}]]></expression>
		</element>
		<element kind="line" uuid="81ed8a4a-ceec-43a9-a0a3-bd4cd7e307e1" x="200" y="25" width="180" height="1" forecolor="#BDC3C7"/>
		<element kind="staticText" uuid="b202d512-08c9-4c42-8c93-19144ca0a58f" x="180" y="35" width="100" height="20" fontSize="12.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
			<text><![CDATA[TOTAL:]]></text>
		</element>
		<element kind="textField" uuid="c2c5a315-1f2c-4b5c-8082-c5768b888f8d" x="280" y="35" width="90" height="20" fontSize="12.0" pattern="#,##0.00" bold="true" hTextAlign="Right" vTextAlign="Middle">
			<expression><![CDATA[$F{grand_total}]]></expression>
		</element>
		<element kind="staticText" uuid="6494fce1-1dc6-413c-ab0c-a172df6292ab" x="180" y="60" width="100" height="15" forecolor="#27AE60" fontSize="10.0" hTextAlign="Right">
			<text><![CDATA[Amount Paid:]]></text>
		</element>
		<element kind="textField" uuid="0dfe0a14-db01-4e77-a1d8-2b9639849159" x="280" y="60" width="90" height="15" forecolor="#27AE60" fontSize="10.0" pattern="#,##0.00" bold="true" hTextAlign="Right">
			<expression><![CDATA[$F{amount_paid}]]></expression>
		</element>
		<element kind="staticText" uuid="b9fed356-ac82-40ad-99e7-6309ec954034" x="180" y="80" width="100" height="15" fontSize="10.0" hTextAlign="Right">
			<text><![CDATA[Balance Due:]]></text>
		</element>
		<element kind="textField" uuid="33c6692c-646e-4194-9ce7-23b615b46146" x="280" y="80" width="90" height="15" fontSize="10.0" pattern="#,##0.00" bold="true" hTextAlign="Right">
			<expression><![CDATA[$V{BalanceDue}]]></expression>
		</element>
		<element kind="staticText" uuid="c696dda6-a01e-44ab-b82b-071759108215" x="0" y="110" width="380" height="20" forecolor="#7F8C8D" fontSize="8.0" italic="true" hTextAlign="Center" vTextAlign="Middle">
			<text><![CDATA[Software solutions by ETec | Thank you for your business!]]></text>
		</element>
	</summary>
</jasperReport>
